<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Place API</title>
    <style>
        html,
        * {
            margin: 0;
            padding: 0;
        }

        h1 {
            height: 150px;
            text-align: center;
            color: rgb(252, 249, 208);
            margin-top: 100px;
            font-size: 40px;
        }
        #time{
             color: rgb(252, 249, 208);
        }

        body {
            height: 100%;
            margin: 0;
            padding: 0;
            /* background-image: url(img/lroc_color_poles_2k.tif); */
        }

        .text_block {
            height: 300px;
        }

        #output p,
        #result p,
        #age_text p {
            text-align: center;
            opacity: 0;
            animation-name: sample01;
            /*â†@keyframesã«ã‚‚åŒã˜åå‰ã‚’è¨˜è¿°*/
            animation-duration: 4s;
            animation-fill-mode: forwards;
            margin-bottom: 10px;
            padding-top: 10px;
            font-weight: bold;
        }

        @keyframes sample01 {

            /*â†animation-nameã«ã‚‚åŒã˜åå‰ã‚’è¨˜è¿°*/
            0% {
                opacity: 0;
                color: #000;
            }

            /* 90% {
                opacity: 1;
                color: rgb(155, 148, 148);
            } */

            100% {
                opacity: 1;
                color: rgb(252, 249, 208);
            }
        }


        .moon_back {
            height: 500px;
            background-image: url(img/lroc_color_poles_2k.jpg);
        }
    </style>
</head>

<body>
    <h1><i>Moon Place API</i></h1>
    <!-- <input type="text">
    <button id="btn">ãƒ‡ãƒ¼ã‚¿å–å¾—</button> -->
    <div class='text_block'>
        <div id="output"></div>
        <div id="result"></div>
        <div id="age_text"></div>
    </div>
    <div class="moon_back"></div>


    <div id="map" style="width:100%;height:500px;"></div>
    <div id="time"></div>
    <!-- <div id="output_2"></div> -->
    <!-- p5js -->
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
    <script src="sketch.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- axiosãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- googlemap -->
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=libraries=places&callback=initMap">
        </script>

    <script>
        function initMap(){
                    function showSuccess(position) {
                //console.log(position);
                const date_obj = new Date();
                const full_year = date_obj.getFullYear();
                const month = date_obj.getMonth() + 1;
                const date = date_obj.getDate();
                const hours = date_obj.getHours();
                const latitude = Math.floor(position.coords.latitude * 100) / 100;//ç·¯åº¦
                const longitude = Math.floor(position.coords.longitude * 100) / 100;//çµŒåº¦

                $('#time').html(date_obj.toString());
                $('#result').html('<p>è‡ªåˆ†ã®ç·¯åº¦ ' + latitude + 'Â° <br>è‡ªåˆ†ã®çµŒåº¦ ' + longitude + 'Â°</p>');

                const url = `https://mgpn.org/api/moon/position.cgi?json&y=${full_year}&m=${month}&d=${date}&h=${hours}&lat=${latitude}&lon=${longitude}`
                axios
                    .get(url)
                    .then(function (response) {
                        console.log(response);
                        console.log(response.data.result.age);
                        const altitude = Math.floor(response.data.result.altitude * 100) / 100;//é«˜åº¦ å°‘æ•°ç¬¬äºŒä½
                        const azimuth = Math.floor(response.data.result.azimuth * 100) / 100;//æ–¹ä½ å°‘æ•°ç¬¬äºŒä½
                        const age_text = Math.round(response.data.result.age * 10) / 10;//å°‘æ•°ç¬¬ä¸€ä½
                        const age = Math.round(response.data.result.age);//å°‘æ•°ç¬¬ä¸€ä½
                        console.log(age);
                        x=age_text
                        //$('#age_text').html('<p>æœˆé½¢ï¼š ' + age_text + '</p>');

                        //æœˆé½¢ã‚’å‡ºã™ifæ–‡ ãŠã‹ã—ã„ï¼ï¼â¬…ï¸èã
                        if (0 <= age_text <= 1) {
                            //alert('foo')
                            $('#age_text').html('<p>ä¸‰æ—¥æœˆ<br>æœˆé½¢ ' + age_text + '</p>');
                        }if (2 <= age_text <= 3) {
                            //alert('yey');
                            $('#age_text').html('<p>äºŒæ—¥æœˆ<br>æœˆé½¢ ' + age_text + '</p>');
                        }if (4 <= age_text <= 5) {
                            //alert('none');
                            $('#age_text').html('<p>ä¸‰æ—¥æœˆ<br>æœˆé½¢ ' + age_text + '</p>');
                        } if (6 <= age_text <= 7) {
                            //alert('none');
                            $('#age_text').html('<p>ä¸‰æ—¥æœˆâ¬…ï¸èã<br>æœˆé½¢ ' + age_text + '</p>');
                        }


                        //æ–¹ä½ã‚’å‡ºã™ifæ–‡ ãŠã‹ã—ã„ï¼ï¼â¬…ï¸èã
                        if (247.5 <= azimuth < 292.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â¬…ï¸è¥¿ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (292.5 <= azimuth < 337.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â†–åŒ—è¥¿ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (337.5 <= azimuth && azimuth < 22.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=ğŸ‘†åŒ—ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (22.5 <= azimuth < 67.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â†—ï¸åŒ—æ±ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (67.5 <= azimuth < 112.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â‡¨æ±ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        } if (112.5<= azimuth < 157.5) {
                            //console.log(azimuth);
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â†˜ï¸å—æ±ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (157.5 <= azimuth < 202.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â†“å—ï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        }if (202.5 <= azimuth < 247.5) {
                            $('#output').html('<p>æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½=â†™ï¸å—è¥¿â¬…ï¸èãï¼ˆ' + azimuth + ' Â°ï¼‰</p>');
                        } else { alert('ä½•ã‹ãŠã‹ã—ã„ã§ã™ã­ã€œã€‚') }

                        //é«˜åº¦çš„ã«æœˆãŒè¦‹ãˆãã†ã‹è¦‹ãˆãªã•ãã†ã‹ã€‚
                        if (altitude > 0) {
                            alert('æœˆãŒè¦‹ãˆã‚‹ã‹ã‚‚ã€‚ã€‚æœˆãŒè¦‹å®ˆã£ã¦ã„ã¾ã™ã€‚');
                            $('body').css('background-color', 'black');
                        } else {
                            alert('æœˆã¯è¦‹ãˆãªã„ã€‚ã€‚');
                            $('body').css('background-color', 'black');
                            $('body').on('click', function () {
                                $('body').css('background-color', 'rgb(252, 249, 208)');
                            });
                        }

                        //googolemap è¿½åŠ 
                        let latlng = new google.maps.LatLng(latitude, longitude);
                        // Google Mapsã«æ›¸ãå‡ºã—
                        let map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 15,// ã‚ºãƒ¼ãƒ å€¤
                            center: latlng,// ä¸­å¿ƒåº§æ¨™
                            mapTypeId: "roadmap", //roadmap,hybrid(è¡›ç”Ÿï¼‹åœ°å›³)ã€stallite(è¡›æ˜Ÿ)ã€terrain(åœ°å½¢)
                            styles: [{
                                featureType: 'all', //ãã®ã»ã‹ã®featureTypeã¯"https://developers.google.com/maps/documentation/javascript/style-reference"
                                stylers: [{
                                    hue: '#e6b422' //è‰²ç›¸ 16é€²æ•°ã®RGBå€¤ã‚’è¨˜è¼‰
                                }, {
                                    saturation: 0//å½©åº¦ -100ã€œ100ã®å€¤ã‚’è¨˜è¼‰
                                }, {
                                    lightness: 0 //æ˜åº¦ -100ã€œ100ã®å€¤ã‚’è¨˜è¼‰
                                }, {
                                    gamma: 0.8 //ã‚¬ãƒ³ãƒå€¤ 0.01ã€œ10.0ã®å€¤ã‚’è¨˜è¼‰
                                }]
                            }]
                        });

                        let targetMarker = new google.maps.Marker({ //ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½œæˆ
                            position: latlng,//ç·¯åº¦çµŒåº¦ã‚’ä¸­å¿ƒã«ã™ã‚‹
                            map: map,
                            //title: title
                        });

                        // infowindowç”¨ã®DOMã‚’ç”Ÿæˆ
                        let content = ' <p> æœˆã®é«˜åº¦ ' + altitude + ' Â° <br>æœˆã®æ–¹ä½ ' + azimuth + ' Â°</p>';

                        // infowindowã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
                        let infowindow = new google.maps.InfoWindow({
                            content: content
                        });

                        // infowindowã‚’è¡¨ç¤º
                        infowindow.open(map, targetMarker);

                        // ãƒãƒ¼ã‚«ãƒ¼ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã«infowindowã‚’è¡¨ç¤º
                        // targetMarker.addListener('click', function () {
                        //     infobox.open(map, targetMarker);
                        // });
                        $('targetMarker').on('click', function () {
                            infowindow.open(map, targetMarker);
                        })
                    })
                    .catch(function (error) {
                        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¤±æ•—æ™‚ã®å‡¦ç†ï¼ˆerrorã«ã‚¨ãƒ©ãƒ¼å†…å®¹ãŒå…¥ã£ã¦ã„ã‚‹ï¼‰
                        console.log(error);
                    })
                    .finally(function () {
                        // æˆåŠŸå¤±æ•—ã«é–¢ã‚ã‚‰ãšå¿…ãšå®Ÿè¡Œ
                        console.log("done!");
                    });
            }

            function showError(error) {
                const errorMessages = [
                    "ä½ç½®æƒ…å ±ãŒè¨±å¯ã•ã‚Œã¦ã¾ã›ã‚“",
                    "ç¾åœ¨ä½ç½®ã‚’ç‰¹å®šã§ãã¾ã›ã‚“",
                    "ä½ç½®æƒ…å ±ã‚’å–å¾—ã™ã‚‹å‰ã«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã«ãªã‚Šã¾ã—ãŸ",
                ];
                alert(`error:${errorMessages[error.code - 1]}`);
            }
            const option = {
                enableHighAccuracy: true,
                maximumAge: 20000,
                timeout: 100000,
            };

            window.onload = function () {//window.onload:ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã¿çµ‚ã‚ã£ã¦ã‹ã‚‰ã¨ã„ã†æ„å‘³(Googleã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿çµ‚ã‚ã‚‰ã›ã‚‹ãŸã‚)
                navigator.geolocation.getCurrentPosition(showSuccess, showError, option);//æˆåŠŸã¨å¤±æ•—ã‚’åˆ¤æ–­
            };//getCurrentPositionã¯å®Ÿè¡Œã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ä½ç½®æƒ…å ±ã‚’ã¨ã‚‹ã€€watchPosition:ä½ç½®ã‚’ã¨ã‚Šç¶šã‘ã‚‹ã‚‚ã®ã‚ã‚‹

        }

    </script>

</body>

</html>